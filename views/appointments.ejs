<!DOCTYPE html>
<html>
<head>
    <title>Appointments - Zynk</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap">
    <link rel="stylesheet" href="/stylesheets/style.css">
    <link rel="stylesheet" href="/stylesheets/appoitments.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="logo">
                <i class="bi bi-calendar-heart"></i>
                <span>Zynk</span>
            </div>
            
            <nav class="nav">
                <a href="/" class="nav-link">
                    <i class="bi bi-house"></i>
                    <span>Dashboard</span>
                </a>
                <a href="/appointments" class="nav-link active">
                    <i class="bi bi-calendar-event"></i>
                    <span>Appointments</span>
                </a>
                <a href="insights" class="nav-link">
                    <i class="bi bi-calendar-event"></i>
                    <span>AI Insights</span>
                </a>
                <a href="/doctor" class="nav-link">
                    <i class="bi bi-heart-pulse"></i>
                    <span>Doctor Portal</span>
                </a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="page-header">
                <div>
                    <h1>Appointments</h1>
                    <p>Manage all your appointments</p>
                </div>
                <div class="header-actions">
                    <div class="search-box">
                        <i class="bi bi-search"></i>
                        <input type="text" id="searchInput" placeholder="Search...">
                    </div>
                    <a href="/" class="btn-primary">
                        <i class="bi bi-plus"></i>
                        New
                    </a>
                </div>
            </header>

            <!-- Stats -->
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-icon total">
                        <i class="bi bi-calendar3"></i>
                    </div>
                    <div>
                        <div class="stat-number"><%= stats.total %></div>
                        <div class="stat-label">Total</div>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon pending">
                        <i class="bi bi-clock"></i>
                    </div>
                    <div>
                        <div class="stat-number"><%= stats.pending %></div>
                        <div class="stat-label">Pending</div>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon completed">
                        <i class="bi bi-check-circle"></i>
                    </div>
                    <div>
                        <div class="stat-number"><%= stats.completed %></div>
                        <div class="stat-label">Completed</div>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon cancelled">
                        <i class="bi bi-x-circle"></i>
                    </div>
                    <div>
                        <div class="stat-number"><%= stats.cancelled %></div>
                        <div class="stat-label">Cancelled</div>
                    </div>
                </div>
            </div>

            <!-- Filters -->
            <div class="filters">
                <div class="filter-group">
                    <button class="filter-btn active" data-filter="all">All</button>
                    <button class="filter-btn" data-filter="pending">Pending</button>
                    <button class="filter-btn" data-filter="completed">Completed</button>
                    <button class="filter-btn" data-filter="cancelled">Cancelled</button>
                </div>
            </div>

            <!-- Appointments Grid -->
            <div class="appointments-grid">
                <% if (appointments.length === 0) { %>
                    <div class="empty-state">
                        <i class="bi bi-calendar-x"></i>
                        <h3>No Appointments</h3>
                        <p>No appointments found</p>
                        <a href="/" class="btn-primary">Add First Appointment</a>
                    </div>
                <% } else { %>
                    <% appointments.forEach(function(appointment) { %>
                        <div class="appointment-card" 
                             data-status="<%= appointment.status || 'pending' %>"
                             data-name="<%= appointment.name.toLowerCase() %>"
                             data-phone="<%= appointment.phone %>">
                            
                            <div class="card-header">
                                <div class="patient-avatar">
                                    <span><%= appointment.name.charAt(0).toUpperCase() %></span>
                                </div>
                                <div class="status-badge <%= appointment.status || 'pending' %>">
                                    <%= (appointment.status || 'pending').charAt(0).toUpperCase() + (appointment.status || 'pending').slice(1) %>
                                </div>
                            </div>

                            <div class="card-body">
                                <h4><%= appointment.name %></h4>
                                <div class="appointment-info">
                                    <div class="info-item">
                                        <i class="bi bi-telephone"></i>
                                        <span><%= appointment.phone %></span>
                                    </div>
                                    <div class="info-item">
                                        <i class="bi bi-calendar"></i>
                                        <span><%= new Date(appointment.date).toLocaleDateString() %></span>
                                    </div>
                                    <div class="info-item">
                                        <i class="bi bi-clock"></i>
                                        <span><%= appointment.time %></span>
                                    </div>
                                </div>
                                <div class="type-badge <%= appointment.type %>">
                                    <%= appointment.type.charAt(0).toUpperCase() + appointment.type.slice(1) %>
                                </div>
                            </div>

                            <div class="card-actions">
                                <% if (!appointment.status || appointment.status === 'pending') { %>
                                    <button class="btn-small btn-primary" onclick="updateStatus('<%= appointment._id %>', 'in-progress')">
                                        Start
                                    </button>
                                    <button class="btn-small btn-secondary" onclick="editAppointment('<%= appointment._id %>')">
                                        Edit
                                    </button>
                                    <button class="btn-small btn-danger" onclick="updateStatus('<%= appointment._id %>', 'cancelled')">
                                        Cancel
                                    </button>
                                <% } else if (appointment.status === 'in-progress') { %>
                                    <button class="btn-small btn-success" onclick="updateStatus('<%= appointment._id %>', 'completed')">
                                        Complete
                                    </button>
                                    <button class="btn-small btn-secondary" onclick="editAppointment('<%= appointment._id %>')">
                                        Edit
                                    </button>
                                <% } else { %>
                                    <button class="btn-small btn-secondary" onclick="editAppointment('<%= appointment._id %>')">
                                        View
                                    </button>
                                    <button class="btn-small btn-danger" onclick="deleteAppointment('<%= appointment._id %>')">
                                        Delete
                                    </button>
                                <% } %>
                            </div>
                        </div>
                    <% }); %>
                <% } %>
            </div>
        </main>
    </div>

    <script>
        // Search functionality
        document.getElementById('searchInput').addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            const cards = document.querySelectorAll('.appointment-card');
            
            cards.forEach(card => {
                const name = card.dataset.name;
                const phone = card.dataset.phone;
                const isVisible = name.includes(searchTerm) || phone.includes(searchTerm);
                card.style.display = isVisible ? 'block' : 'none';
            });
        });

        // Filter functionality
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                // Update active button
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                
                const filter = this.dataset.filter;
                const cards = document.querySelectorAll('.appointment-card');
                
                cards.forEach(card => {
                    if (filter === 'all' || card.dataset.status === filter) {
                        card.style.display = 'block';
                    } else {
                        card.style.display = 'none';
                    }
                });
            });
        });

        // Status update
        function updateStatus(id, status) {
            if (status === 'cancelled' && !confirm('Cancel this appointment?')) return;
            if (status === 'completed' && !confirm('Mark as completed?')) return;
            
            fetch(`/appointments/${id}/status`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ status })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    location.reload();
                } else {
                    alert('Error updating appointment');
                }
            })
            .catch(() => alert('Error updating appointment'));
        }

        // Delete appointment
        function deleteAppointment(id) {
            if (!confirm('Permanently delete this appointment?')) return;
            
            fetch(`/appointments/${id}`, {
                method: 'DELETE'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    location.reload();
                } else {
                    alert('Error deleting appointment');
                }
            })
            .catch(() => alert('Error deleting appointment'));
        }

        // Edit appointment (simple redirect for now)
        function editAppointment(id) {
            // For simplicity, just redirect to main page with appointment ID
            window.location.href = `/?edit=${id}`;
        }
    </script>
</body>
</html>